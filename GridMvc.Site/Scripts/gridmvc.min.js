window.pageGrids=window.pageGrids||{},$.fn.extend({gridmvc:function(){var t=[];return($(this).each(function(){if($(this).data("gridmvc"))t.push($(this).data("gridmvc"));else{var e={lang:$(this).attr("data-lang"),selectable:"true"==$(this).attr("data-selectable"),multiplefilters:"true"==$(this).attr("data-multiplefilters")},i=new GridMvc(this,e);$(this).attr("data-gridname").length>0&&(window.pageGrids[$(this).attr("data-gridname")]=i),t.push(i),$(this).data("gridmvc",i)}}),1==t.length)?t[0]:t}}),void 0===(GridMvc=function(t){function e(e,i){this.jqContainer=t(e),i=i||{},this.options=t.extend({},this.defaults(),i),this.init()}return e.prototype.init=function(){this.lang=GridMvc.lang[this.options.lang],void 0===this.lang&&(this.lang=GridMvc.lang.en),this.events=[],this.options.selectable&&this.initGridRowsEvents(),this.filterWidgets=[],this.addFilterWidget(new TextFilterWidget),this.addFilterWidget(new NumberFilterWidget),this.addFilterWidget(new DateTimeFilterWidget),this.addFilterWidget(new BooleanFilterWidget),this.addFilterWidget(new QueryFilterWidget),this.addFilterWidget(new SelectListFilterWidget),this.openedMenuBtn=null,this.initFilters()},e.prototype.initGridRowsEvents=function(){var t=this;this.jqContainer.on("click",".grid-row",function(){t.rowClicked.call(this,t)})},e.prototype.rowClicked=function(e){if(e.options.selectable){var i=t(this).closest(".grid-row");if(!(i.length<=0)){var n={};i.find(".grid-cell").each(function(){var e=t(this).attr("data-name");e.length>0&&(n[e]=t(this).text())});var r=t.Event("RowClicked");e.notifyOnRowSelect(n,r),r.isDefaultPrevented()||e.markRowSelected(i)}}},e.prototype.markRowSelected=function(t){this.jqContainer.find(".grid-row.grid-row-selected").removeClass("grid-row-selected"),t.addClass("grid-row-selected")},e.prototype.defaults=function(){return{selectable:!0,multiplefilters:!1,lang:"en"}},e.prototype.onRowSelect=function(t){this.events.push({name:"onRowSelect",callback:t})},e.prototype.notifyOnRowSelect=function(t,e){e.row=t,this.notifyEvent("onRowSelect",e)},e.prototype.notifyEvent=function(t,e){for(var i=0;i<this.events.length&&(this.events[i].name!=t||this.events[i].callback(e));i++);},e.prototype.initFilters=function(){var e=this.filterMenuHtml(),i=this;this.jqContainer.find(".grid-filter").each(function(){t(this).click(function(){return i.openFilterPopup.call(this,i,e)})})},e.prototype.openFilterPopup=function(e,i){var n=t(this).attr("data-type")||"",r=e.getFilterWidgetForType(n);if(null==r)return!1;if(this.hasAttribute("data-rendered")){var l=e.openMenuOnClick.call(this,e);return e.setupPopupInitialPosition(t(this)),l||void 0===r.onShow||r.onShow(),l}var a=t(this).attr("data-name")||"",o=t(this).attr("data-filterdata")||"",s=t(this).attr("data-widgetdata")||"{}",p=e.parseFilterValues(o)||{},d=t(this).attr("data-url")||"";t(this).attr("data-rendered","1"),t(this).append(i);var u=t(this).find(".grid-popup-widget");if(void 0!==r.onRender&&r.onRender(u,e.lang,n,p,function(t){e.closeOpenedPopups(),e.applyFilterValues(d,a,t,!1)},t.parseJSON(s)),t(this).find(".grid-filter-btn").hasClass("filtered")&&r.showClearFilterButton()){var c=t(this).find(".grid-popup-additional");c.append(e.getClearFilterButton(d)),c.find(".grid-filter-clear").click(function(){e.applyFilterValues(d,a,"",!0)})}var f=e.openMenuOnClick.call(this,e);return void 0!==r.onShow&&r.onShow(),e.setupPopupInitialPosition(t(this)),f},e.prototype.setupPopupInitialPosition=function(e){var i=e.find(".grid-dropdown");function n(){var t=e.find(".grid-dropdown-arrow");return{arrow:t,currentDropLeft:parseInt(i.css("left")),currentArrowLeft:parseInt(t.css("left"))}}var r=i.offset().left;if(r<0){var l=n();l.arrow.css({left:l.currentArrowLeft+r-10+"px"}),i.css({left:l.currentDropLeft-r+10+"px"});return}var a=i.width(),o=t(window).width()+t(window).scrollLeft()-(r+a);if(o<0){var l=n();l.arrow.css({left:l.currentArrowLeft-o+5+"px"}),i.css({left:l.currentDropLeft+o-5+"px"})}},e.prototype.filterMenuHtml=function(){return'<div class="dropdown dropdown-menu grid-dropdown" style="display: none;">                    <div class="grid-dropdown-arrow"></div>                    <div class="grid-dropdown-inner">                            <div class="grid-popup-widget"></div>                            <div class="grid-popup-additional"></div>                    </div>                </div>'},e.prototype.getClearFilterButton=function(){return'<ul class="menu-list">                    <li><a class="grid-filter-clear" href="javascript:void(0);">'+this.lang.clearFilterLabel+"</a></li>                </ul>"},e.prototype.addFilterWidget=function(t){this.filterWidgets.push(t)},e.prototype.parseFilterValues=function(e){for(var i=t.parseJSON(e),n=[],r=0;r<i.length;r++)n.push({filterValue:this.urldecode(i[r].FilterValue),filterType:i[r].FilterType,columnName:i[r].ColumnName});return n},e.prototype.urldecode=function(t){return decodeURIComponent((t+"").replace(/\+/g,"%20"))},e.prototype.getFilterWidgetForType=function(e){for(var i=0;i<this.filterWidgets.length;i++)if(t.inArray(e,this.filterWidgets[i].getAssociatedTypes())>=0)return this.filterWidgets[i];return null},e.prototype.replaceFilterWidget=function(e,i){for(var n=0;n<this.filterWidgets.length;n++)if(t.inArray(e,this.filterWidgets[n].getAssociatedTypes())>=0)return this.filterWidgets.splice(n,1),this.addFilterWidget(i),!0;return!1},e.prototype.applyFilterValues=function(e,i,n,r){var l=this.jqContainer.find(".grid-filter");e.length>0&&(e+="&");var a="";if(r||(a+=this.getFilterQueryData(i,n)),this.options.multiplefilters)for(var o=0;o<l.length;o++){if(t(l[o]).attr("data-name")!=i){var s=this.parseFilterValues(t(l[o]).attr("data-filterdata"));0!=s.length&&(a.length>0&&(a+="&"),a+=this.getFilterQueryData(t(l[o]).attr("data-name"),s))}}window.location.search=e+a},e.prototype.getFilterQueryData=function(t,e){for(var i="",n=0;n<e.length;n++)i+="grid-filter="+encodeURIComponent(t)+"__"+e[n].filterType+"__"+encodeURIComponent(e[n].filterValue),n!=e.length-1&&(i+="&");return i},e.prototype.openMenuOnClick=function(e){if(t(this).hasClass("clicked"))return!0;e.closeOpenedPopups(),t(this).addClass("clicked");var i=t(this).find(".dropdown-menu");return 0==i.length||(i.show(),i.addClass("opened"),e.openedMenuBtn=t(this),t(document).bind("click.gridmvc",function(t){e.documentCallback(t,e)}),!1)},e.prototype.documentCallback=function(e,i){var n=(e=e||event).target||e.srcElement,r=t(".dropdown-menu.opened").get(0),l=t("html").get(0);if(void 0!==r)do{if(r==n)return;l==n&&(r.style.display="none",t(r).removeClass("opened")),n=n.parentNode}while(n);null!=i.openedMenuBtn&&i.openedMenuBtn.removeClass("clicked"),t(document).unbind("click.gridmvc")},e.prototype.closeOpenedPopups=function(){var e=t(".dropdown-menu.opened");e.hide(),e.removeClass("opened"),null!=this.openedMenuBtn&&this.openedMenuBtn.removeClass("clicked")},e.prototype.selectable=function(t){this.options.selectable=t},e}(window.jQuery)).lang&&(GridMvc.lang={}),GridMvc.lang.en={filterTypeLabel:"Type: ",filterValueLabel:"Value:",applyFilterButtonText:"Apply",filterSelectTypes:{Equals:"Equals",StartsWith:"StartsWith",Contains:"Contains",EndsWith:"EndsWith",GreaterThan:"Greater than",LessThan:"Less than",GreaterThanOrEquals:"Greater than or equals",LessThanOrEquals:"Less than or equals"},code:"en",boolTrueLabel:"Yes",boolFalseLabel:"No",clearFilterLabel:"Clear filter"},TextFilterWidget=function(t){function e(){}return e.prototype.getAssociatedTypes=function(){return["System.String"]},e.prototype.onShow=function(){var t=this.container.find(".grid-filter-input");t.length<=0||t.focus()},e.prototype.showClearFilterButton=function(){return!0},e.prototype.onRender=function(t,e,i,n,r){this.cb=r,this.container=t,this.lang=e,this.value=n.length>0?n[0]:{filterType:1,filterValue:""},this.renderWidget(),this.registerEvents()},e.prototype.renderWidget=function(){var t='<div class="form-group">                        <label>'+this.lang.filterTypeLabel+'</label>                        <select class="grid-filter-type form-control">                            <option value="1" '+("1"==this.value.filterType?'selected="selected"':"")+">"+this.lang.filterSelectTypes.Equals+'</option>                            <option value="2" '+("2"==this.value.filterType?'selected="selected"':"")+">"+this.lang.filterSelectTypes.Contains+'</option>                            <option value="3" '+("3"==this.value.filterType?'selected="selected"':"")+">"+this.lang.filterSelectTypes.StartsWith+'</option>                            <option value="4" '+("4"==this.value.filterType?'selected="selected"':"")+">"+this.lang.filterSelectTypes.EndsWith+'</option>                        </select>                    </div>                    <div class="form-group">                        <label>'+this.lang.filterValueLabel+'</label>                        <input type="text" class="grid-filter-input form-control" value="'+this.value.filterValue+'" />                    </div>                    <div class="grid-filter-buttons">                        <button type="button" class="btn btn-primary grid-apply" >'+this.lang.applyFilterButtonText+"</button>                    </div>";this.container.append(t)},e.prototype.registerEvents=function(){var t=this.container.find(".grid-apply"),e=this;t.click(function(){var t=e.container.find(".grid-filter-type").val(),i=e.container.find(".grid-filter-input").val();e.cb([{filterType:t,filterValue:i}])}),this.container.find(".grid-filter-input").keyup(function(e){13==e.keyCode&&t.click(),27==e.keyCode&&GridMvc.closeOpenedPopups()})},e}(window.jQuery),NumberFilterWidget=function(t){function e(){}return e.prototype.showClearFilterButton=function(){return!0},e.prototype.getAssociatedTypes=function(){return["System.Int32","System.Double","System.Decimal","System.Byte","System.Single","System.Float","System.Int64","System.Int16","System.UInt64","System.UInt32","System.UInt16"]},e.prototype.onShow=function(){var t=this.container.find(".grid-filter-input");t.length<=0||t.focus()},e.prototype.onRender=function(t,e,i,n,r){this.cb=r,this.container=t,this.lang=e,this.typeName=i,this.value=n.length>0?n[0]:{filterType:1,filterValue:""},this.renderWidget(),this.registerEvents()},e.prototype.renderWidget=function(){var t='<div class="form-group">                        <label>'+this.lang.filterTypeLabel+'</label>                        <select class="grid-filter-type form-control">                            <option value="1" '+("1"==this.value.filterType?'selected="selected"':"")+">"+this.lang.filterSelectTypes.Equals+'</option>                            <option value="5" '+("5"==this.value.filterType?'selected="selected"':"")+">"+this.lang.filterSelectTypes.GreaterThan+'</option>                            <option value="6" '+("6"==this.value.filterType?'selected="selected"':"")+">"+this.lang.filterSelectTypes.LessThan+'</option>                        </select>                    </div>                    <div class="form-group">                        <label>'+this.lang.filterValueLabel+'</label>                        <input type="text" class="grid-filter-input form-control" value="'+this.value.filterValue+'" />                    </div>                    <div class="grid-filter-buttons">                        <button type="button" class="btn btn-primary grid-apply">'+this.lang.applyFilterButtonText+"</button>                    </div>";this.container.append(t)},e.prototype.registerEvents=function(){var t=this,e=this.container.find(".grid-apply");e.click(function(){var e=t.container.find(".grid-filter-type").val(),i=t.container.find(".grid-filter-input").val();t.cb([{filterType:e,filterValue:i}])});var i=this.container.find(".grid-filter-input");i.keyup(function(t){13==t.keyCode&&e.click(),27==t.keyCode&&GridMvc.closeOpenedPopups()}).keypress(function(e){return t.validateInput.call(t,e)}),"System.Byte"==this.typeName&&i.attr("maxlength","3")},e.prototype.validateInput=function(t){var e,i=t||window.event,n=i.keyCode||i.which;switch(n=String.fromCharCode(n),this.typeName){case"System.Byte":case"System.Int32":case"System.Int64":case"System.UInt32":case"System.UInt64":e=/[0-9]/;break;default:e=/[0-9]|\.|\,/}!e.test(n)&&(i.returnValue=!1,i.preventDefault&&i.preventDefault())},e}(window.jQuery),DateTimeFilterWidget=function(t){function e(){}return e.prototype.getAssociatedTypes=function(){return["System.DateTime","System.Date","System.DateTimeOffset"]},e.prototype.showClearFilterButton=function(){return!0},e.prototype.onRender=function(e,i,n,r,l,a){this.datePickerIncluded=void 0!==t.fn.datepicker,this.cb=l,this.data=a,this.typeName=n,this.container=e,this.lang=i,this.value=r.length>0?r[0]:{filterType:1,filterValue:""},this.renderWidget(),this.registerEvents()},e.prototype.renderWidget=function(){var t='<div class="form-group">                        <label>'+this.lang.filterTypeLabel+'</label>                        <select class="grid-filter-type form-control">                            <option value="1" '+("1"==this.value.filterType?'selected="selected"':"")+">"+this.lang.filterSelectTypes.Equals+'</option>                            <option value="5" '+("5"==this.value.filterType?'selected="selected"':"")+">"+this.lang.filterSelectTypes.GreaterThan+'</option>                            <option value="6" '+("6"==this.value.filterType?'selected="selected"':"")+">"+this.lang.filterSelectTypes.LessThan+"</option>                        </select>                    </div>"+(this.datePickerIncluded?'<div class="grid-filter-datepicker"></div>':'<div class="form-group">                                <label>'+this.lang.filterValueLabel+'</label>                                <input type="text" class="grid-filter-input form-control" value="'+this.value.filterValue+'" />                             </div>                             <div class="grid-filter-buttons">                                <input type="button" class="btn btn-primary grid-apply" value="'+this.lang.applyFilterButtonText+'" />                             </div>');if(this.container.append(t),this.datePickerIncluded){var e=this.data||{};e.format=e.format||"yyyy-mm-dd",e.language=e.language||this.lang.code;var i=this,n=this.container.find(".grid-filter-datepicker");n.datepicker(e).on("changeDate",function(t){var e=[{filterType:i.container.find(".grid-filter-type").val(),filterValue:t.format()}];i.cb(e)}),this.value.filterValue&&n.datepicker("update",this.value.filterValue)}},e.prototype.registerEvents=function(){var t=this,e=this.container.find(".grid-apply");e.click(function(){var e=t.container.find(".grid-filter-type").val(),i=t.container.find(".grid-filter-input").val();t.cb([{filterType:e,filterValue:i}])}),this.container.find(".grid-filter-input").keyup(function(t){13==t.keyCode&&e.click()})},e}(window.jQuery),BooleanFilterWidget=function(t){function e(){}return e.prototype.getAssociatedTypes=function(){return["System.Boolean"]},e.prototype.showClearFilterButton=function(){return!0},e.prototype.onRender=function(t,e,i,n,r){this.cb=r,this.container=t,this.lang=e,this.value=n.length>0?n[0]:{filterType:1,filterValue:""},this.renderWidget(),this.registerEvents()},e.prototype.renderWidget=function(){var t="<label>"+this.lang.filterValueLabel+'</label>                    <ul class="menu-list">                        <li><a class="grid-filter-choose '+("true"==this.value.filterValue?"choose-selected":"")+'" data-value="true" href="javascript:void(0);">'+this.lang.boolTrueLabel+'</a></li>                        <li><a class="grid-filter-choose '+("false"==this.value.filterValue?"choose-selected":"")+'" data-value="false" href="javascript:void(0);">'+this.lang.boolFalseLabel+"</a></li>                    </ul>";this.container.append(t)},e.prototype.registerEvents=function(){var e=this;this.container.find(".grid-filter-choose").click(function(){var i=[{filterType:"1",filterValue:t(this).attr("data-value")}];e.cb(i)})},e}(window.jQuery),QueryFilterWidget=function(t){function e(){}return e.prototype.getAssociatedTypes=function(){return["QueryFilter"]},e.prototype.onShow=function(){var t=this.container.find(".grid-filter-input");t.length<=0||t.focus()},e.prototype.showClearFilterButton=function(){return!0},e.prototype.onRender=function(t,e,i,n,r){this.cb=r,this.container=t,this.lang=e,this.value=n.length>0?n[0]:{filterType:1,filterValue:""},this.renderWidget(),this.registerEvents()},e.prototype.renderWidget=function(){var t='<div class="form-group">                        <label>'+this.lang.filterValueLabel+'</label>                        <input type="text" class="grid-filter-input form-control" value="'+this.value.filterValue+'" />                    </div>                    <div class="grid-filter-buttons">                        <button type="button" class="btn btn-primary grid-apply" >'+this.lang.applyFilterButtonText+"</button>                    </div>";this.container.append(t)},e.prototype.registerEvents=function(){var t=this.container.find(".grid-apply"),e=this;t.click(function(){var t=e.container.find(".grid-filter-input").val();e.cb([{filterValue:t}])}),this.container.find(".grid-filter-input").keyup(function(e){13==e.keyCode&&t.click(),27==e.keyCode&&GridMvc.closeOpenedPopups()})},e}(window.jQuery),SelectListFilterWidget=function(t){function e(){e.prototype.getAssociatedTypes=function(){return["SelectListWidget"]},e.prototype.onShow=function(){},e.prototype.showClearFilterButton=function(){return!0},e.prototype.onRender=function(t,e,i,n,r,l){this.cb=r,this.container=t,this.lang=e,this.items=l,this.value=n.length>0?n[0]:{filterType:1,filterValue:""},this.renderWidget(),this.registerEvents()},e.prototype.renderWidget=function(){for(var t=this.items,e='<div class="form-group"><select class="grid-filter-type enums-list form-control">',i=0;i<t.length;i++)e+="<option "+(t[i]==this.value.filterValue?'selected="selected"':"")+' value="'+t[i].Value+'">'+t[i].Text+"</option>";e+="</select></div>",e+='<div class="grid-filter-buttons">                        <button type="button" class="btn btn-primary grid-apply">'+this.lang.applyFilterButtonText+"</button>                    </div>",this.container.append(e)},e.prototype.registerEvents=function(){var t=this;this.container.find(".grid-apply").click(function(){var e=[{filterValue:t.container.find(".enums-list").val(),filterType:1}];t.cb(e)})}}return e}(window.jQuery),function(t){t&&t(function(){t(".grid-mvc").each(function(){t(".grid-mvc").gridmvc()})})}(window.jQuery);